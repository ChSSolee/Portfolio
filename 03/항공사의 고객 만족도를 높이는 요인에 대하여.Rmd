---
title: "항공사의 고객 만족도를 높이는 요인에 대하여"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. 서론

### 분석을 하게된 동기나 배경 
- 이번 학기 학습한 로지스틱 회귀를, 방대한 양의 BI(Buisness Intelligence) 데이터에 직접 적용을 해봄으로서, 반응변수(항공사 서비스 만족 여부에 대한 오즈)에 설명변수가 어떤 영향을 미치는지를 파악하기 위해 본 주제를 선택.
- 더 나아가 로지스틱 회귀가 가진 예측 및 분류기로서의 특성 또한, 해당 분석을 통하여 직접 확인하고자 함.

### 수집한 자료의 출처 및 성격
- "US Airline Passenger Satisfaction"
- 수집한 자료는 2015년 미국의 항공사를 이용한 12만 명 이상의 고객들의 서비스 만족도에 대한 데이터로서, 항공사와 고객의 이름은 기업정보 및 개인정보의 이유로 식별할 수 없음.

### 변수

- Satisfaction : 고객 만족 여부 / 명목형 (1 = 만족 / 0 = 중립 또는 불만족) 
- Gender : 고객의 성별 / 명목형 (Female = 여성 / Male = 남성)
- Customer.Type : 고객 유형 / 명목형 (disloyal Customer = 충성도가 낮은 고객 / Loyal Customer = 충성도가 높은 고객 )
- Age : 고객의 연령 / 수치형
- Type.of.Travel : 고객의 탑승 목적 / 명목형 (Personal Travel = 개인적 목적 / Business Travel = 비즈니스 목적)
- Class : 좌석 유형 / 명목형 (Business = 비즈니스 석 / Eco Plus = 이코노미 플러스 / Eco = 이코노미)
- Flight.Distance : 비행 거리(노트) / 수치형
- Seat.comfort : 착석감 / 순서형 (0 ~ 5)
- Dep.Arr.time.convenient : 도착/출발 편리성 / 순서형 (0 ~ 5)
- Food.and.drink : 기내식 만족도 / 순서형 (0 ~ 5)
- Gate.location : 게이트 위치 만족도 / 순서형 (0 ~ 5)
- Inflight.entertainment : 기내 오락 만족도 / 순서형 (0 ~ 5)
- Online.support : 온라인 지원 만족도 / 순서형 (0 ~ 5)
- Ease.of.Online.booking : 온라인 예약 용이성 / 순서형 (0 ~ 5)
- On.board.service : 기내 서비스 만족도 / 순서형 (0 ~ 5)
- Leg.room.service : 레그룸 만족도 / 순서형 (0 ~ 5)
- Baggage.handling : 수화물 처리 만족도 / 순서형 (0 ~ 5)
- Checkin.service : 체크인 서비스 만족도 / 순서형 (0 ~ 5)
- Cleanliness : 청결도 / 순서형 (0 ~ 5)
- Online.boarding : 온라인 탑승 만족도 / 순서형 (0 ~ 5)
- Departure.Delay : 출발 지연 시간(분) / 수치형
- Arrival.Delay : 도착 지연 시간(분) / 수치형

### 분석을 수행하기 전 예상하는 결과

- 고객의 성별, 고객의 연령, 고객의 탑승 목적, 비행 거리별 항공사의 서비스 만족에 대한 오즈의 차이는 없거나, 작을 것이다.
- 충성도가 높은 고객이, 그렇지 않은 고객보다 항공사의 서비스에 만족하는 경향이 있을 것이다.
- ‘이코노미 -> 이코노미 플러스 -> 비즈니스’의 좌석 유형 순으로 항공사의 서비스 만족에 대한 오즈가 높을 것이다.
- 모든 순서형 변수는 증가할수록, 항공사의 서비스 만족에 대한 오즈가 높아질 것이다.
- 도착 지연 시간과 출발 지연 시간이 증가할수록, 항공사의 서비스 만족에 대한 오즈가 낮아질 것이다.

## 2. 본론

### 데이터 전처리
```{r pressure1, warning=FALSE}
setwd("C:/Users/이찬솔")
data <- read.csv("US Airline Passenger Satisfaction.csv", header = T)
sum(is.na(data)) # 결측값 확인
```
```{r pressure2}
data <- na.omit(data) # 결측값 제거
sum(is.na(data))
```

- 분석에 앞서, 데이터內 393개의 결측값의 존재를 확인, 본 프로젝트는 결측값을 별도의 값으로 대체하지 않고, 제외하여 분석하는 완전분석법에 따라 진행하기로 결정.

```{r pressure3}
data$Satisfaction <- as.factor(data$Satisfaction)
data$Gender <- as.factor(data$Gender)
data$Customer.Type <- as.factor(data$Customer.Type)
data$Class <- as.factor(data$Class)
data$Type.of.Travel <- as.factor(data$Type.of.Travel)
dim(data)
```
- as.factor()함수를 통해 명목형 변수들을 설정.
- 모형의 간결함과, 해석의 용이성을 위하여, 본 분석에서는 순서형 변수들을 양적변수로 간주하여 모형을 적합하기로 결정.
- 전처리를 마무리한 데이터의 차원은 129487개의 행과, 22개의 열로 구성됨을 확인.

### 적합할 모형 설정
- 모형 설정에 앞서 이 데이터는 총 21개의 많은 설명변수들을 포함하는 만큼, 양적변수들간의 상관계수 및 VIF값을 파악하여 높은 상관관계 여부를 파악할 필요가 있다.
```{r pressure4}
quan_var <- cbind(data[,4], data[,7:22]) ; colnames(quan_var) <- c(3, 6:21)
cor <- cor(quan_var) 
tail(round(cor,3), 5)
```
```{r pressure5}
GGally::ggcorr(quan_var, name = "corr", label = T)
```
```{r pressure6}
diag(solve(cor))
```

- 상관계수 행렬 cor과 이를 “GGally”패키지의 ggcorr()함수를 통해 히트맵으로 시각화한 결과, 20번째 설명변수(출발 지연 시간)와, 21번째 설명변수(도착 지연 시간)간 높은 상관관계가 있음을 확인 할 수 있었다. 또한 해당 변수들의 VIF값들 또한 10이상의 값을 가짐으로서, 다중공선성의 존재를 알 수 있다.
- 이는 상식적으로 항공기의 출발에 지연이 있다면, 도착에 지연이 발생할 확률이 높아지는 것은 당연한 결과라고 할 수 있다. 따라서 이에 대한 보완으로, 두 변수중 하나인 ‘출발 지연 시간’을 분석에서 제외하기로 결정하였다.
- 이후 다시 계산한 VIF값에서는 10이상의 값을 가지는 변수가 없음을 확인하였다.

```{r pressure7}
set.seed(2021)
idx <- sample(1:nrow(data), 10000)
dat <- data[idx,]
dim(dat)
```

- 129487명의 고객 데이터에서, 10000명의 랜덤 추출한 데이터를 사용 

```{r pressure8, results="hide"}
Fullmod = glm(Satisfaction ~ ., dat = dat[,-21], family = binomial(link = "logit"))
backward <- step(Fullmod, direction = "backward") ; formula(backward)
```

- ‘출발 지연 시간’을 제외한 모든 설명변수를 포함한 완전모형에서 step()함수의 후진 소거법을 적용하여 최저의 AIC값을 가지는 모형을 탐색한 결과, 완전모형과 동일한 모형을 얻을 수 있었다.
- 이에 따라 본 분석에서는 완전모형을 적합하기로 결정하였다.

### 모형 적합
```{r pressure9}
summary(Fullmod)
```

- 모든 설명변수를 포함한 완전모형을 적합하였을 때의 회귀계수, 이탈도, AIC값은 위의 결과와 같다.
- 모든 회귀계수 추정값은 통계적으로 유의하며, 모형의 이탈도는 7510.5로서, 자유도 9978의 카이제곱분포 상위 0.05분위수  10211.49보다 작다. 따라서 현재모형의 적합도는 좋다고 해석 할 수 있다.
```{r pressure10}
qchisq(0.95, 9978) 
```
- 다만, 데이터가 10000 X 21 의 차원을 가진 크기가 큰 데이터라는 점을 고려하였을 때, 위 결과의 낮은 P-값들과 그에 따른 통계적 유의성은 데이터의 크기 때문일 수도 있다는 점을 인지해야 된다.

### 오즈비 계산 및 회귀 계수 해석

```{r echo = FALSE, results = 'axis'}
library(knitr)
a <- as.data.frame(round(exp(Fullmod$coefficients), 4))
kable(a)
```

- 고객의 성별이 남성일 때의 오즈가, 여성일 때의 오즈의 0.39배이다. 즉, 서비스에 만족하는 경향은 남성보다 여성이 더 크다.
- 충성도가 높은 고객의 오즈가 충성도가 낮은 고객의 오즈보다 7.5배 크다.
- 고객의 연령이 1세 증가할 때마다, 서비스 만족에 대한 오즈는 1%씩 감소한다.
- 개인적 목적의 이용고객의 오즈가 비즈니스 목적 이용고객의 오즈의 0.47배이며, 서비스에 만족하는 경향은 비즈니스 목적 이용고객이 더 크다.
- 좌석 유형이 이코노미와 이코노미 플러스 일 때의 오즈는 각각 비즈니스 석 일 때 오즈의 0.45, 0.42배이다. 즉 ‘이코노미 플러스 -> 이코노미 -> 비즈니스’의 순으로 항공사의 서비스 만족에 대한 오즈가 높다.
- 비행거리가 1노트 증가할 때마다, 서비스 만족에 대한 오즈는 0.1%씩 감소한다.
- 도착/출발 편리성과, 기내식 만족도를 제외한 모든 만족도는 점수가 1점 증가할 때마다, 서비스 만족에 대한 오즈가 증가한다.
- 도착 지연 시간이 1분 증가할 때마다, 서비스 만족에 대한 오즈는 0.6%씩 감소한다.

### 모형의 예측값은, 전체 데이터에 대하여 얼마나 높은 정확도를 보이는가?

- 분석에서 적합한 로지스틱 모형의 평가를 위하여, 모형을 바탕으로 각 고객이 항공사의 서비스에 만족할 확률()을 예측하여 실제 고객의 응답결과와 대조하면 예측 정확도, 즉 ‘정분류율’을 계산할 수 있다.

- (단 pred()함수의 type을 “response”로 설정하여 계산된 각각의 예측값()들을 반올림하여, 0.5이상이라면 1(만족), 그렇지 않다면 0이라는 가정이 필요하다.)

```{r pressure`11}
pred <- predict(Fullmod, newdata = data, type = "response")
pred1 <- as.factor(ifelse(pred < 0.5, 0, 1))
(CM <- table(pred1, data$Satisfaction)) 
```
```{r pressure`12}
mean(pred1 == data$Satisfaction)
```

- 위의 결과의 CM은 예측값들과 실제값들을 대조한 행렬이다. (가로 = 실제값, 세로 = 예측값)
- 분석에서 적합한 모형을 바탕으로 예측한 고객들의 만족여부가, 실제 고객들의 만족여부와 일치할 확률은 0.8357 (83.57%)임을 알 수 있다.


## 3. 결론

### 실제 분석결과와 예상했던 결과와의 비교

- 예상과 다르게 고객의 성별별로 만족에 대한 오즈의 차이가 있으며, 여성이 남성보다 서비스에 만족하는 경향이 크다.
- 예상과 동일하게 충성도가 높은 고객이 충성도가 낮은 고객보다 서비스에 만족하는 경향이 크다
- 예상과 동일하게 고객의 연령이 증가할 때마다 서비스에 만족하는 경향은 감소하지만, 그 폭은 크지 않다.
- 예상과 다르게 고객의 이용목적별로 만족에 대한 오즈의 차이가 있으며, 비즈니스 목적 이용고객이 개인적 목적 이용고객보다 서비스에 만족하는 경향이 크다.
- 예상과 비슷하게 좌석 유형별 만족에 대한 오즈의 차이가 있으나, ‘이코노미 -> 이코노미 플러스 -> 비즈니스’의 순으로 서비스에 만족하는 경향이 크다.
- 예상과 동일하게 비행거리가 증가할 때마다 서비스에 만족하는 경향은 감소하지만, 그 폭은 크지 않다.
- 예상과 다르게 모든 순서형 변수가 값이 증가할수록, 서비스 만족에 대한 경향이 커지지는 않는다.
- 예상과 다르게 도착 지연 시간이 증가할수록 서비스 만족에 대한 경향은 감소하지만, 그 폭은 크지 않다.

### 가능한 추가 분석의 방향

- 다른 국가 및 항공사 데이터의 수집과 분석을 통한, 본 프로젝트와의 비교.
- 2015년만이 아닌 최근 데이터의 수집과 분석을 통한, 본 프로젝트와의 비교.
- 전체 데이터를 사용하는 것이 아닌, 훈련데이터/평가데이터의 분할 및 추출을 통한 교차 검증(Cross Validation)과 그에 따른 예측 정확도 개선.
- 이외의 예측·분류 알고리즘(예 : 서포트 벡터 머신, 부스팅, 의사결정나무 등)들을 적용하여 로지스틱 회귀와 비교. 
